<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>解析接口</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <div>
        <h2>消息</h2>
    </div>
    <script>
        const sorpid = 'wwe7832a2285c7bb51';

        const url = 'http://jiegiser.win';

        const codeUrl = encodeURI(url);

        const Secret = 'R-C1HIUbWqKxZicYDTRpEtK0LCT4_R4BzH1s4P3h0ko';

        const agenttid = '1000002';


        // var code = location.href.split('?')[1].split('&')[0].split('=')[1];
        // alert(code);

        $(function ($) {
            var url = 'https://qyapi.weixin.qq.com/cgi-bin/gettoken';
            // $.ajax(url, {
            //     data: {
            //         'corpid': sorpid,
            //         'corpsecret': Secret
            //     },
            //     // headers: {
            //     //     'Content-Type': 'application/x-www-form-urlencoded'
            //     // },
            //     //   dataType:'jsonp',
            //     //  crossDomain: true,
            //     success: function (data) {
            //         if (data) {
            //             console.log(JSON.parse(data));
            //         }
            //     }
            // });




            // $.ajax({
            //     type: "get", //请求方式
            //     async: true, //是否异步
            //     url: "https://qyapi.weixin.qq.com/cgi-bin/gettoken",
            //     dataType: "jsonp", //跨域json请求一定是jsonp
            //     jsonp: "callbackparam", //跨域请求的参数名，默认是callback
            //     //jsonpCallback:"successCallback",    //自定义跨域参数值，回调函数名也是一样，默认为jQuery自动生成的字符串
            //     data: {
            //         'corpid': sorpid,
            //         'corpsecret': Secret
            //     },

            //     beforeSend: function () {
            //         //请求前的处理
            //     },

            //     success: function (da) {
            //         console.log(da);
            //         //请求成功处理，和本地回调完全一样
            //     },

            //     complete: function () {
            //         //请求完成的处理
            //     },

            //     error: function () {
            //         //请求出错处理
            //     }
            // });

            var ajaxPostData = {
                'corpid': sorpid,
                'corpsecret': Secret
            }
            $.ajax({
                url: "https://qyapi.weixin.qq.com/cgi-bin/gettoken",
                type: "GET",
                data: JSON.stringify(ajaxPostData),
                dataType: "json",
                success: function (data) {
                    //On ajax success do this
                    console.info("success.");
                    if (data["status"] == "ok") {
                        alert("Settings is Ok. The Machine is rebooting.");
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    //On error do this
                    console.info("error.");
                    if (xhr.status == 200) {

                        alert(ajaxOptions);
                    } else {
                        alert(xhr.status);
                        alert(thrownError);
                    }
                }
            });


        });

        //     axios.get(
        //             `https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=${sorpid}&corpsecret=${Secret}`
        //         )
        //         .then((response) => {
        //             console.log(`accsee_token=${response}`);
        //             // axios.get(
        //             //         `https://qyapi.weixin.qq.com/cgi-bin/user/getuserinfo?access_token=${response}&code=${code}`
        //             //     )
        //             //     .then((info) => {
        //             //         console.log(`用户信息=${info}`);
        //             //     })
        //             //     .catch((er) => {
        //             //         console.log(`获取用户信息失败=${er}`);
        //             //     })
        //         })
        //         .catch((error) => {
        //             console.log(`获取access_token失败=${error}`);
        //         })
        // });

        // window.onload = function () {
        // alert("获取数据");
        // $.get(`https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=${sorpid}&corpsecret=${Secret}`, function (
        //     response) {
        //     alert(response);
        // })









        // axios.get(
        //         `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${sorpid}&redirect_uri=${codeUrl}&response_type=code&scope=snsapi_base&agentid=${agenttid}&state=loudi#wechat_redirect`
        //     )
        //     .then((res) => {
        //         let code = res;
        //         console.log(`code=${code}`);
        // axios.get(
        //         `https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=${sorpid}&corpsecret=${Secret}`
        //     )
        //     .then((response) => {
        //         console.log(`accsee_token=${response}`);
        //         axios.get(
        //                 `https://qyapi.weixin.qq.com/cgi-bin/user/getuserinfo?access_token=${response}&code=${code}`
        //             )
        //             .then((info) => {
        //                 console.log(`用户信息=${info}`);
        //             })
        //             .catch((er) => {
        //                 console.log(`获取用户信息失败=${er}`);
        //             })
        //     })
        //     .catch((error) => {
        //         console.log(`获取access_token失败=${error}`);
        //     })

        //})
        // .catch(function (error) {
        //     if (error.response) {
        //         // 请求已发出，但服务器响应的状态码不在 2xx 范围内
        //         console.log(error.response.data);
        //         console.log(error.response.status);
        //         console.log(error.response.headers);
        //     } else {
        //         // Something happened in setting up the request that triggered an Error
        //         console.log('Error', error.message);
        //     }
        //     console.log(error.config);
        // });
        // }



        //获取openId
        // $(function () {
        //     //获取location.href中的code
        //     var code = location.href.split('?')[1].split('&')[0].split('=')[1];
        //     alter(code);
        //后台获取access_token

        //后台还没有给我，给我之后我再写一下
        // var access_token=access_token;

        //

        //根据code获取openId
        // function changeCode() {
        //     $.ajax({
        //         type: 'GET',
        //         url: 'https://qyapi.weixin.qq.com/cgi-bin/user/getuserinfo?access_token=' +
        //             access_token + '&code=' + code,
        //         dataType: 'json',
        //         success: function (data) {
        //             if (data.success) {
        //                 var openId;
        //                 //如果是企业成员授权，返回userId,转为openId,
        //                 //如果是非企业成员授权，返回openId
        //                 if (data.UserId) {
        //                     var userId = data.UserId;
        //                     //userId装换为openId
        //                     $.ajax({
        //                         type: 'POST',
        //                         url: 'https://qyapi.weixin.qq.com/cgi-bin/user/convert_to_openid?access_token=' +
        //                             access_token,
        //                         dataType: 'json',
        //                         data: {
        //                             userid: userId
        //                         },
        //                         success: function (data) {
        //                             if (data.success) {
        //                                 openId = data.openid
        //                             }
        //                         }
        //                     });
        //                 } else {
        //                     openId = data.OpenId;
        //                 }
        //             } else {
        //                 console.log('获取接口失败');
        //             }
        //         },
        //         error: function (jqXHR) {
        //             console.log('发生错误:' + jqXHR.status);
        //         }
        //     });
        // }
        // });
    </script>
</body>

</html>